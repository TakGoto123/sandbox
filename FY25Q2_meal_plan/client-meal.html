<script>
/**
 * çŒ®ç«‹è¡¨ç¤ºã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
 * ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã•ã‚ŒãŸJavaScriptã‚¯ãƒ©ã‚¹
 */
class MealPlanApp {
  constructor(headers, data, config) {
    this.headers = headers;
    this.raw_meal_plan = data;
    this.structured_meal_plan = {};
    this.raw_meal_plan.forEach(([date, type, menu, memo, id]) => {
      this.structured_meal_plan[id] = { id, date, type, menu, memo };
    });
    this.local_meal_plan = {};
    this.deleted_meal = {};
    this.config = config;
    
    // è¨­å®šã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    if (!this.config) {
      this.config = {
        SHEET_NAME: 'menu-schedule',
        MEAL_TYPES: ['å¼å½“', 'å¤œ'],
        DATE_FORMAT: 'yyyy-MM-dd',
        TIMEZONE: 'Asia/Tokyo',
        WEEK_START_DAY: 6,
        WORK_DAYS: [2, 3, 4, 5, 6]
      };
    }
    
    // ç¾åœ¨ã®é€±ã®é–‹å§‹æ—¥ã‚’è¨­å®šï¼ˆå…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’ä½¿ç”¨ï¼‰
    this.currentWeekStart = WeekManager.getCurrentWeekStart();
    
    // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã¨åŒæœŸ
    appState.setCurrentWeekStart(this.currentWeekStart);
    
    // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›
    this.logDebugInfo();
  }

  setData(data) {
    this.raw
  }

  /**
   * ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›
   */
  logDebugInfo() {
    console.log('=== çŒ®ç«‹ã‚¢ãƒ—ãƒªåˆæœŸåŒ– ===');
    console.log('Headers:', this.headers);
    console.log('Data count:', this.raw_meal_plan ? this.raw_meal_plan.length : 0);
    console.log('Config:', this.config);
    console.log('Current week start:', this.currentWeekStart);
  }

  /**
   * é€±ã‚’å¤‰æ›´
   * @param {number} offset - é€±ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆ-1: å‰é€±, 1: æ¬¡é€±ï¼‰
   */
  changeWeek(offset) {
    this.currentWeekStart = WeekManager.calculateNewWeekStart(this.currentWeekStart, offset);
    appState.setCurrentWeekStart(this.currentWeekStart);
    this.renderTable();
  }

  /**
   * é€±ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ•´ç†
   * @param {Array<string>} weekDates - é€±ã®æ—¥ä»˜é…åˆ—
   * @returns {Object} æ•´ç†ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿
   */
  organizeWeekData(weekDates) {
    const mealTypes = this.config?.MEAL_TYPES || ['å¼å½“', 'å¤œ'];
    const weekData = {};
    
    // åˆæœŸåŒ–
    weekDates.forEach(date => {
      weekData[date] = {};
      mealTypes.forEach(type => {
        weekData[date][type] = [];
      });
    });

    // ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†é¡
    const merged_data = {...this.structured_meal_plan, ...this.local_meal_plan};
    if (Object.keys(merged_data).length > 0) {
      for (const {id, date, type, menu, memo} of Object.values(merged_data)) {
        let dateRaw = date;
      
        // æ—¥ä»˜ã®æ­£è¦åŒ–å‡¦ç†ã‚’æ”¹å–„
        let dateStr = '';
        if (dateRaw instanceof Date) {
          dateStr = WeekManager.formatDate(dateRaw);
        } else if (typeof dateRaw === 'string') {
          // æ—¢ã«yyyy-MM-ddå½¢å¼ã®å ´åˆã¯ãã®ã¾ã¾ä½¿ç”¨
          if (/^\d{4}-\d{2}-\d{2}$/.test(dateRaw.trim())) {
            dateStr = dateRaw.trim();
          } else {
            // ãã®ä»–ã®æ–‡å­—åˆ—å½¢å¼ã®å ´åˆã¯Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
            const parsedDate = new Date(dateRaw);
            if (!isNaN(parsedDate.getTime())) {
              dateStr = WeekManager.formatDate(parsedDate);
            } else {
              console.warn('Invalid date format:', dateRaw);
              return; // ç„¡åŠ¹ãªæ—¥ä»˜ã¯ã‚¹ã‚­ãƒƒãƒ—
            }
          }
        } else {
          console.warn('Unexpected date type:', typeof dateRaw, dateRaw);
          return; // äºˆæœŸã—ãªã„å‹ã¯ã‚¹ã‚­ãƒƒãƒ—
        }
        
        // menuãŒ{text: url: }å½¢å¼ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¾ãŸã¯æ–‡å­—åˆ—ã®å ´åˆã®å‡¦ç†
        let parsedMenu = menu;
        
        // æ—¢ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã®å ´åˆã¯ãã®ã¾ã¾ä½¿ç”¨
        if (typeof menu === 'object' && menu !== null && menu.text && menu.url) {
          parsedMenu = menu;
        }
        // æ–‡å­—åˆ—ã§JSONå½¢å¼ã®å ´åˆã¯ãƒ‘ãƒ¼ã‚¹
        else if (typeof menu === 'string' && menu.includes('{') && menu.includes('}')) {
          try {
            const parsed = JSON.parse(menu);
            if (parsed.text && parsed.url) {
              parsedMenu = { text: parsed.text, url: parsed.url };
            }
          } catch (e) {
            // JSONãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ãŸå ´åˆã¯å…ƒã®å€¤ã‚’ä½¿ç”¨
            parsedMenu = menu;
          }
        }
        
        if (weekData[dateStr] && mealTypes.includes(type) && !(this.deleted_meal[id])) {
          weekData[dateStr][type].push({ menu: parsedMenu || '', memo: memo || '', id: id });
        }
      }
    }

    return weekData;
  }

  /**
   * ãƒ†ãƒ¼ãƒ–ãƒ«ã®HTMLã‚’ç”Ÿæˆ
   * @param {Array<string>} weekDates - é€±ã®æ—¥ä»˜é…åˆ—
   * @param {Object} weekData - æ•´ç†ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿
   * @returns {string} ãƒ†ãƒ¼ãƒ–ãƒ«ã®HTML
   */
  generateTableHTML(weekDates, weekData) {
    const mealTypes = this.config?.MEAL_TYPES || ['å¼å½“', 'å¤œ'];
    let html = '<table><thead><tr>';
    
    // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ
    if (this.headers && Array.isArray(this.config.MEAL_PLAN_HEADERS)) {
      this.config.MEAL_PLAN_HEADERS.forEach(header => {
        html += `<th>${UIUtils.escapeHtml(header)}</th>`;
      });
    }
    // å‰Šé™¤åˆ—ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
    html += '<th>æ“ä½œ</th>';
    html += '</tr></thead><tbody>';

    // å„æ—¥ä»˜ã®ç·è¡Œæ•°ã‚’è¨ˆç®—ï¼ˆæ—¥ä»˜ã‚»ãƒ«ã®rowspanç”¨ï¼‰
    const dateRowCounts = {};
    weekDates.forEach(date => {
      let totalRows = 0;
      mealTypes.forEach(type => {
        const meals = weekData[date][type];
        // ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯ãƒ‡ãƒ¼ã‚¿è¡Œæ•° + è¿½åŠ ãƒœã‚¿ãƒ³è¡Œã€ãªã„å ´åˆã¯è¿½åŠ ãƒœã‚¿ãƒ³è¡Œã®ã¿
        totalRows += meals.length > 0 ? meals.length + 1 : 1;
      });
      dateRowCounts[date] = totalRows;
    });

    let globalRowIndex = 0;
    
    // ãƒ‡ãƒ¼ã‚¿è¡Œã‚’ç”Ÿæˆ
    weekDates.forEach((date, dateIndex) => {
      let isFirstDateRow = true;
      
      mealTypes.forEach((type, typeIndex) => {
        const meals = weekData[date][type];
        // ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯ãƒ‡ãƒ¼ã‚¿è¡Œæ•° + è¿½åŠ ãƒœã‚¿ãƒ³è¡Œã€ãªã„å ´åˆã¯è¿½åŠ ãƒœã‚¿ãƒ³è¡Œã®ã¿
        const typeRowspan = meals.length > 0 ? meals.length + 1 : 1;
        let isFirstTypeRow = true;

        // ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã®ã¿æ—¢å­˜ã®çŒ®ç«‹è¡Œã‚’è¡¨ç¤º
        if (meals.length > 0) {
          meals.forEach((meal, mealIndex) => {
            // è¡Œã®CSSã‚¯ãƒ©ã‚¹ã‚’æ±ºå®š
            let rowClasses = [];
            
            // æ—¥ä»˜ã‚°ãƒ«ãƒ¼ãƒ—ã®å¢ƒç•Œç·š
            if (dateIndex > 0 && isFirstDateRow && isFirstTypeRow && mealIndex === 0) {
              rowClasses.push('date-group-border');
            }
            
            // åŒºåˆ†ã‚°ãƒ«ãƒ¼ãƒ—ã®å¢ƒç•Œç·šï¼ˆåŒã˜æ—¥ä»˜å†…ã§åŒºåˆ†ãŒå¤‰ã‚ã‚‹å ´åˆï¼‰
            if (typeIndex > 0 && isFirstTypeRow && mealIndex === 0) {
              rowClasses.push('type-group-border');
            }
            
            // äº¤äº’ã®è¡Œè‰²ï¼ˆæ—¥ä»˜ã”ã¨ã«åˆ‡ã‚Šæ›¿ãˆï¼‰
            if (dateIndex % 2 === 0) {
              rowClasses.push('row-even');
            } else {
              rowClasses.push('row-odd');
            }
            
            const rowClassAttr = rowClasses.length > 0 ? ` class="${rowClasses.join(' ')}"` : '';
            html += `<tr${rowClassAttr}>`;
            
            // æ—¥ä»˜ã‚»ãƒ«ï¼ˆæ—¥ä»˜ã®æœ€åˆã®è¡Œã®ã¿ï¼‰
            if (isFirstDateRow) {
              html += `<td class="date-cell" rowspan="${dateRowCounts[date]}">${WeekManager.formatDisplayDate(date)}</td>`;
              isFirstDateRow = false;
            }
            
            // åŒºåˆ†ã‚»ãƒ«ï¼ˆåŒºåˆ†ã®æœ€åˆã®è¡Œã®ã¿ï¼‰
            if (isFirstTypeRow) {
              html += `<td class="type-cell" rowspan="${typeRowspan}">${UIUtils.escapeHtml(type)}</td>`;
              isFirstTypeRow = false;
            }
            
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚»ãƒ«
            html += `<td class="menu-cell">${UIUtils.renderMenuCell(meal.menu)}</td>`;
            
            // ãƒ¡ãƒ¢ã‚»ãƒ«
            html += `<td class="memo-cell">${UIUtils.escapeHtml(meal.memo)}</td>`;
            
            // å‰Šé™¤ãƒœã‚¿ãƒ³ã‚»ãƒ«
            const menuText = typeof meal.menu === 'object' && meal.menu !== null && meal.menu.text ? meal.menu.text : meal.menu;
            let menu_id = meal.id;
            html += `<td class="action-cell">
              <button class="delete-meal-btn" onclick="handleDeleteButtonPushed('${menu_id}')" title="å‰Šé™¤">
                ğŸ—‘ï¸
              </button>
            </td>`;
            
            html += '</tr>';
            globalRowIndex++;
          });
        }
        
        // è¿½åŠ ãƒœã‚¿ãƒ³è¡Œ
        let addRowClasses = ['add-meal-row'];
        
        // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã®å¢ƒç•Œç·šå‡¦ç†
        if (meals.length === 0) {
          // æ—¥ä»˜ã‚°ãƒ«ãƒ¼ãƒ—ã®å¢ƒç•Œç·š
          if (dateIndex > 0 && isFirstDateRow && isFirstTypeRow) {
            addRowClasses.push('date-group-border');
          }
          
          // åŒºåˆ†ã‚°ãƒ«ãƒ¼ãƒ—ã®å¢ƒç•Œç·šï¼ˆåŒã˜æ—¥ä»˜å†…ã§åŒºåˆ†ãŒå¤‰ã‚ã‚‹å ´åˆï¼‰
          if (typeIndex > 0 && isFirstTypeRow) {
            addRowClasses.push('type-group-border');
          }
        }
        
        const addRowClassAttr = addRowClasses.length > 0 ? ` class="${addRowClasses.join(' ')}"` : '';
        html += `<tr${addRowClassAttr}>`;
        
        // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã®æ—¥ä»˜ãƒ»åŒºåˆ†ã‚»ãƒ«
        if (meals.length === 0) {
          // æ—¥ä»˜ã‚»ãƒ«ï¼ˆæ—¥ä»˜ã®æœ€åˆã®è¡Œã®ã¿ï¼‰
          if (isFirstDateRow) {
            html += `<td class="date-cell" rowspan="${dateRowCounts[date]}">${WeekManager.formatDisplayDate(date)}</td>`;
            isFirstDateRow = false;
          }
          
          // åŒºåˆ†ã‚»ãƒ«ï¼ˆåŒºåˆ†ã®æœ€åˆã®è¡Œã®ã¿ï¼‰
          if (isFirstTypeRow) {
            html += `<td class="type-cell" rowspan="${typeRowspan}">${UIUtils.escapeHtml(type)}</td>`;
            isFirstTypeRow = false;
          }
        }
        
        html += `<td class="menu-cell"><button class="add-meal-btn" onclick="openAddMealModal('${date}', '${type}')" title="çŒ®ç«‹ã‚’è¿½åŠ ">+</button></td>`;
        html += `<td class="memo-cell"></td>`;
        html += `<td class="action-cell"></td>`;
        html += `</tr>`;
      });
    });

    html += '</tbody></table>';
    return html;
  }

  /**
   * ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æç”»
   */
  renderTable() {
    try {
      console.log('=== ãƒ†ãƒ¼ãƒ–ãƒ«æç”»é–‹å§‹ ===');
      console.log('Current week start:', this.currentWeekStart);
      
      const weekDates = WeekManager.getWeekDates(this.currentWeekStart, this.config?.WORK_DAYS);
      console.log('Week dates:', weekDates);
      
      // é€±è¡¨ç¤ºã‚’æ›´æ–°
      const weekDisplayElement = document.getElementById('weekDisplay');
      if (weekDisplayElement) {
        weekDisplayElement.textContent = WeekManager.formatWeekDisplay(weekDates);
      }

      // ãƒ‡ãƒ¼ã‚¿ã‚’æ•´ç†
      const weekData = this.organizeWeekData(weekDates);
      console.log('Organized data:', weekData);

      // ãƒ†ãƒ¼ãƒ–ãƒ«HTMLç”Ÿæˆ
      const tableHTML = this.generateTableHTML(weekDates, weekData);
      
      // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ›´æ–°
      const tableElement = document.getElementById('mealTable');
      if (tableElement) {
        tableElement.innerHTML = tableHTML;
      }

      console.log('=== ãƒ†ãƒ¼ãƒ–ãƒ«æç”»å®Œäº† ===');
    } catch (error) {
      console.error('Table render error:', error);
      UIUtils.showError('ãƒ†ãƒ¼ãƒ–ãƒ«ã®æç”»ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message, 'mealTable');
    }
  }

  /**
   * ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆæœŸåŒ–
   */
  initialize() {
    console.log('=== çŒ®ç«‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ– ===');
    this.renderTable();
  }
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦å®£è¨€
let mealPlanAppInstance = null;

/**
 * çŒ®ç«‹ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤º
 */
function showMealPlan() {
  console.log('Switching to meal plan page');
  appState.setCurrentPage('meal');
  
  // ã‚¿ãƒ–ã®çŠ¶æ…‹ã‚’æ›´æ–°
  document.getElementById('mealTab').classList.add('active');
  document.getElementById('weekendTab').classList.remove('active');
  const todoTab = document.getElementById('todoTab');
  if (todoTab) {
    todoTab.classList.remove('active');
  }
  
  // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
  document.getElementById('pageTitle').textContent = 'çŒ®ç«‹ä¸€è¦§';
  
  // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ã®è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
  document.getElementById('mealContent').style.display = 'block';
  document.getElementById('weekendContent').style.display = 'none';
  const todoContent = document.getElementById('todoContent');
  if (todoContent) {
    todoContent.style.display = 'none';
  }
  
  // è²·ã„å‡ºã—ãƒªã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
  const shoppingSection = document.getElementById('shoppingListSection');
  if (shoppingSection) {
    shoppingSection.style.display = 'block';
  }
  
  // çŒ®ç«‹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å†æç”»
  if (mealPlanAppInstance) {
    // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã¨åŒæœŸ
    mealPlanAppInstance.currentWeekStart = appState.getCurrentWeekStart();
    mealPlanAppInstance.renderTable();
  }
}

/**
 * çŒ®ç«‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆæœŸåŒ–
 * @param {Array} headers - ãƒ˜ãƒƒãƒ€ãƒ¼é…åˆ—
 * @param {Array} data - ãƒ‡ãƒ¼ã‚¿é…åˆ—
 * @param {Object} config - è¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 */
function initializeMealPlanApp(headers, data, config) {
  try {
    console.log('Initializing MealPlanApp...');
    mealPlanAppInstance = new MealPlanApp(headers, data, config);
    mealPlanAppInstance.initialize();
    console.log('MealPlanApp initialized successfully');
    return mealPlanAppInstance;
  } catch (error) {
    console.error('Failed to initialize MealPlanApp:', error);
    UIUtils.showError('çŒ®ç«‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'mealTable');
    return null;
  }
}

/**
 * è²·ã„å‡ºã—ãƒªã‚¹ãƒˆä½œæˆ
 */
function createShoppingList() {
  // ç¾åœ¨è¡¨ç¤ºä¸­ã®é€±ã®æ—¥ä»˜ã‚’å–å¾—
  const weekDates = WeekManager.getWeekDates(mealPlanAppInstance.currentWeekStart, mealPlanAppInstance.config?.WORK_DAYS);
  const startDate = weekDates[0]; // æ—¢ã«æ–‡å­—åˆ—å½¢å¼ï¼ˆyyyy-MM-ddï¼‰
  const endDate = weekDates[weekDates.length - 1]; // æ—¢ã«æ–‡å­—åˆ—å½¢å¼ï¼ˆyyyy-MM-ddï¼‰
  
  // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
  const confirmed = confirm(
    'è²·ã„å‡ºã—ãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚\n\n' +
    `å¯¾è±¡æœŸé–“: ${startDate} ï½ ${endDate}\n` +
    'ãƒ»å‡¦ç†ã«ã¯æ•°åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™\n' +
    'ãƒ»æ—¢å­˜ã®è²·ã„å‡ºã—ãƒªã‚¹ãƒˆã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™\n\n' +
    'ç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ'
  );
  
  if (!confirmed) {
    return;
  }
  
  // å‡¦ç†çŠ¶æ…‹ã‚’è¡¨ç¤º
  showProcessingState();
  
  // ã‚µãƒ¼ãƒãƒ¼é–¢æ•°ã‚’å‘¼ã³å‡ºã—ï¼ˆForAppã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ä»˜ãï¼‰
  google.script.run
    .withSuccessHandler(onShoppingListCreated)
    .withFailureHandler(onShoppingListError)
    .createShoppingListForPeriodForApp(startDate, endDate);
}

/**
 * è²·ã„å‡ºã—ãƒªã‚¹ãƒˆä½œæˆæˆåŠŸæ™‚ã®å‡¦ç†
 * @param {Object} result - ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®çµæœ
 */
function onShoppingListCreated(result) {
  hideProcessingState();
  
  if (result.success) {
    const message = `${result.message}\n\n` +
                    `å¯¾è±¡æœŸé–“: ${result.period}\n` +
                    `ã‚·ãƒ¼ãƒˆå: ${result.sheetName}\n\n` +
                    'Weekendã‚¿ãƒ–ã§ç¢ºèªã—ã¾ã™ã‹ï¼Ÿ';
    
    if (confirm(message)) {
      // Weekendã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆ
      showWeekend();
    }
  } else {
    alert('ã‚¨ãƒ©ãƒ¼: ' + result.message);
  }
}

/**
 * è²·ã„å‡ºã—ãƒªã‚¹ãƒˆä½œæˆã‚¨ãƒ©ãƒ¼æ™‚ã®å‡¦ç†
 * @param {Object} error - ã‚¨ãƒ©ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 */
function onShoppingListError(error) {
  hideProcessingState();
  console.error('Shopping list creation error:', error);
  alert('è²·ã„å‡ºã—ãƒªã‚¹ãƒˆä½œæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\n\n' + error.message);
}

/**
 * å‡¦ç†ä¸­çŠ¶æ…‹ã‚’è¡¨ç¤º
 */
function showProcessingState() {
  const btn = document.getElementById('createShoppingListBtn');
  if (btn) {
    btn.disabled = true;
    btn.innerHTML = 'â³ ä½œæˆä¸­... (æ•°åˆ†ãŠå¾…ã¡ãã ã•ã„)';
    btn.classList.add('processing');
  }
}

/**
 * å‡¦ç†ä¸­çŠ¶æ…‹ã‚’éè¡¨ç¤º
 */
function hideProcessingState() {
  const btn = document.getElementById('createShoppingListBtn');
  if (btn) {
    btn.disabled = false;
    btn.innerHTML = 'ğŸ›’ è²·ã„å‡ºã—ãƒªã‚¹ãƒˆã‚’ä½œæˆ';
    btn.classList.remove('processing');
  }
}


function handleDeleteButtonPushed(id) {
  if (modalHandlerInstance) {
    console.warn("modalHandlerInstance.structured_meal_plan", mealPlanAppInstance.structured_meal_plan);
    modalHandlerInstance.openDeleteModal(mealPlanAppInstance.structured_meal_plan[id]);
  } else {
    console.error('ModalHandler instance not found');
  }
}


console.log('Meal plan module loaded successfully');
</script>
